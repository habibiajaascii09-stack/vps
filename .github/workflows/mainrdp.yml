name: Deploy VPS with Pterodactyl

on:
  workflow_dispatch:
    inputs:
      tailscale_key:
        description: 'Tailscale Auth Key'
        required: true
      ssh_password_key:
        description: 'SSH Password'
        required: true

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v2

    - name: Run VPS Setup Script
      run: |
        # Menyimpan input dari workflow ke variabel
        TAILSCALE_KEY="${{ github.event.inputs.tailscale_key }}"
        SSH_PASSWORD_KEY="${{ github.event.inputs.ssh_password_key }}"
        SSH_PRIVATE_KEY="\
        -----BEGIN OPENSSH PRIVATE KEY-----
        your-ssh-private-key
        -----END OPENSSH PRIVATE KEY-----"
        
        # Membuat direktori .ssh jika belum ada
        mkdir -p ~/.ssh
        
        # Menyimpan SSH Key
        echo "$SSH_PRIVATE_KEY" > ~/.ssh/id_rsa
        chmod 600 ~/.ssh/id_rsa

        # Menjalankan perintah di VPS
        sshpass -p "$SSH_PASSWORD_KEY" ssh -o StrictHostKeyChecking=no user@your-vps-ip << 'EOF'
          # Install Tailscale
          curl -fsSL https://tailscale.com/install.sh | sh
          tailscale up --authkey=$TAILSCALE_KEY
          
          # Install Docker
          apt-get update && apt-get install -y docker.io
          
          # Install Panel Pterodactyl tanpa Wings
          docker run -d --name pterodactyl-panel \
            -e APP_URL=http://your-vps-ip \
            -e DB_PASSWORD=your_db_password \
            -p 80:80 \
            pterodactyl/panel:latest
        
          # Tampilkan informasi sebelum tidur
          echo "IP VPS: your-vps-ip"
          echo "VPS Password: your_vps_password"
          echo "Panel Login: ashifaja123@gmail.com"
          echo "Panel Password: ashifaja123"
        
          # Tunggu selama 6 jam
          sleep 21600 # 6 jam dalam detik
        EOF
