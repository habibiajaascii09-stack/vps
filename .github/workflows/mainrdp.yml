name: Pterodactyl Panel Full Setup

on:
  workflow_dispatch:
    inputs:
      start:
        description: "Run Pterodactyl Setup?"
        required: true
        default: "yes"

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    # ======================================================
    # 1. Update packages
    # ======================================================
    - name: Update
      run: sudo apt update -y

    # ======================================================
    # 2. Install SSH for JuiceSSH login
    # ======================================================
    - name: Install SSH Server (JuiceSSH Ready)
      run: |
        sudo apt install -y openssh-server
        sudo systemctl enable ssh --now
        echo "root:123456" | sudo chpasswd
        echo "üîê SSH Login:"
        echo "User: root"
        echo "Pass: 123456"
        echo "Public IP: $(curl -s ifconfig.me)"

    # ======================================================
    # 3. Install Docker
    # ======================================================
    - name: Install Docker
      run: |
        curl -fsSL https://get.docker.com | sh
        sudo systemctl start docker

    # ======================================================
    # 4. Install Tailscale
    # ======================================================
    - name: Install & Start Tailscale
      run: |
        curl -fsSL https://tailscale.com/install.sh | sh
        sudo tailscale up --ssh --authkey=${{ secrets.TSKEY }} --accept-dns=false
        echo "Tailscale IP:"
        tailscale ip

